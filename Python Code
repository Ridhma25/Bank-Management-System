import mysql.connector
from datetime import date

class admin():
    __ad_name='Head'  #Class variable
    __ad_pswd='1234'  #Class variable
    def admin():
        ad_name=input("Enter admin name:")
        ad_pswd=input("Enter admin password:")
        if(ad_name=='Head' and ad_pswd=='1234'):
            print('\n1. Closed Account History')
            print("\n2. Back to main menu")
            choice=int(input('\n Enter your choice:'))
            if choice == 1:
                print('\n1. Daily report')
                print("\n2. Monthly report")
                choice=int(input('\n Enter your choice:'))
                if choice == 1:
                    admin.a_daily_report()
                if choice == 2:
                    bank.a_monthly_report()  
            if choice == 2:
                front()
        else:
            print("Invalid admin!!!!")

    def account_status(acno):
        conn = mysql.connector.connect(
      host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        sql1='Select * from acc_details;'
        cursor.execute(sql1)
        result1=cursor.fetchall()
        print(result1)
        for c in result1:
            print(c)
            for k in c:
                print(k)
                if(acno==(k)):
                    sql ="select status , balance from acc_details where account_no ={};".format(acno)
                    result = cursor.execute(sql)
                    result = cursor.fetchone()
                    conn.commit()
                    conn.close()
                    return result
        else:
            print("Invalid Account!!")
            bank.main_menu()
        #status=account_staus(acno)
    def a_monthly_report():
        conn = mysql.connector.connect(
          host='localhost', database='bankproject', user='root', password=' ')
        today = date.today()
        cursor = conn.cursor()
        sql = "select account_no from acc_details  where status = 'close';"
        cursor.execute(sql)
        result=cursor.fetchall()
        #print(result)
        for c in result:
            #print(c)
            acno=c[0]
            sql = "select tid,dot,amount,type,account_no from transaction  where month(dot)='{}' and account_no={};".format( str(today).split('-')[1],acno)
            cursor.execute(sql)
            records = cursor.fetchall()
        print('Monthly Report :',today)
        print('-'*50)
        print(records)
        print('-'*50)

        conn.close()
        wait = input('\n\n Press any key to continue....')
        front()

    
    
    def a_daily_report():
        conn = mysql.connector.connect(host='localhost', database='bankproject', user='root', password=' ')
        today = date.today()
        cursor = conn.cursor()
        sql = "select account_no from acc_details  where status = 'close';"
        cursor.execute(sql)
        result=cursor.fetchall()
        #print(result)
        for c in result:
            #print(c)
            acno=c[0]
            sql = "select tid,dot,amount,type,account_no from transaction  where dot='{}' and account_no = {};".format(str(today),acno)
            cursor.execute(sql)
            records = cursor.fetchall()
        print('Daily Report :',today)
        print('-'*120)
        print(records)
        print('-'*120)

        conn.close()
        wait = input('\n\n\n Press any key to continue....')
        front()
    

class user(admin):
    def __init__(self,us_name,us_pswd):
        self.us_name=us_name
        self.us_pswd=us_pswd

    def account_status(acno):
        super().account_status(acno)

    def usign_up():
        user.us_name=input("Enter user name:")
        user.us_pswd=input("Enter user password:")
        conn = mysql.connector.connect(host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        sql="insert into data values('{}','{}');".format(user.us_name,user.us_pswd)
        cursor.execute(sql)
        conn.commit()
        conn.close()
        print("Account created!\n Go to sign in")
        front()

    


class bank(user):
    def __init__(self,us_name,us_pswd):
        super().__init__(us_name,us_pswd)

    def main_menu():
        while True:
            print(' Main Menu')
            print("\n1.  Add Account")
            print('\n2.  Modify Account')
            print('\n3.  Close Account')
            print('\n4.  Transaction Menu')
            print('\n5.  Search Menu')
            print('\n6.  Account Details')
            print('\n7.  Close application')
            print('\n\n')
            choice = int(input('Enter your choice ...: '))
            if choice == 1:
                bank.add_account()
            if choice == 2:
                bank.modify_account()
            if choice == 3:
                bank.close_account()
            if choice ==4 :
                bank.transaction_menu()
            if choice ==5 :
                bank.search_menu()
            if choice == 6:
                bank.report_menu()
            if choice==7:
                break
        front()


    def usign_in():
        user.us_name=input("Enter user name:")
        user.us_pswd=input("Enter user password:")
        conn = mysql.connector.connect(
         host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        sql="select * from data ;"
        cursor.execute(sql)
        result=cursor.fetchall()
        #print(result)
        for c in result:
          #print(c)
          if (user.us_name and user.us_pswd in c):
            bank.main_menu()
        else:
            front()
        conn.commit()
        conn.close()

            
    def current(balance):
        if(5000<=balance):
            flag=1
            return flag
        else:
            print("Minimum opening balance for current account is 5000. \n Account not added.")
            flag=0
            return flag
        

    def saving(balance):
        today=date.today()
        print("You will recieve 7.5% interest rate yearly on your opening balance.")
        flag=1
        return flag
  
    def add_account():
        conn = mysql.connector.connect(
            host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        
        name = input('Enter Name :')
        acc_no=int(input('Enter acc no :'))
        addr = input('Enter address ')
        phone = int(input('Enter Phone no :'))
        email = input('Enter Email :')
        aadhar = int(input('Enter AAdhar no :'))
        actype = input('Account Type (saving/current ) :')
        balance = float(input('Enter opening balance :'))
        if(actype=='current' or actype=='Current'):
            flag=bank.current(balance)
        elif(actype=='saving' or actype=='Saving'):
            flag=bank.saving(balance)
        else:
            print("Invalid!!")
        if flag==1:
            sql = "insert into acc_details(account_no,name,address,mobile_no,email,aadhar_no,balance,account_type) values ( {},'{}','{}',{},'{}',{},{},'{}');".format(acc_no,name,addr,phone,email,aadhar,balance,actype)
            cursor.execute(sql)
            conn.commit()
            conn.close()
            print('New customer added successfully')


    def getstatus(acc_no):
        conn = mysql.connector.connect(host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        sql="Select status from acc_details where account_no={};".format(acc_no)
        cursor.execute(sql)
        res=cursor.fetchall()
        return res

    def modify_account():
        conn = mysql.connector.connect(
            host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        acno = input('Enter customer Account No :')
        statuss=bank.getstatus(acno)
        if(statuss[0][0]=='close'):
            print("ACCOUNT IS CLOSED")
        else:
            print('Modify screen ')
            print('\n 1.  Customer Name')
            print('\n 2.  Customer Address')
            print('\n 3.  Customer Phone No')
            print('\n 4.  Customer Email ID')
            choice = int(input('What do you want to change ? '))
            new_data  = input('Enter New value :')
            field_name=''
            if choice == 1:
                field_name ='name'
            if choice == 2:
                 field_name = 'address'
            if choice == 3:
                 field_name = 'mobile_no'
            if choice == 4:
                 field_name = 'email'
            sql ="update acc_details set {} = '{}' where account_no= {} ;".format(field_name,new_data,acno) 
            #print(sql)
            cursor.execute(sql)
            conn.commit()
            conn.close()
            print('Customer Information modified..')


    def close_account():
        conn = mysql.connector.connect(
            host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        acno = input('Enter customer Account No :')
        sql ="update acc_details set status= 'close' where account_no = {} ;".format(acno)
        cursor.execute(sql)
        conn.commit()
        conn.close()
        print('Account closed')

    
    def deposit_amount():
        conn = mysql.connector.connect(host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        acno = input('Enter account No :')
        amount = input('Enter amount :')
        today = date.today()
        #print(acno)
        result = admin.account_status(int(acno))
        print(result)
        if result [0]== 'active':
            tid=str(acno)+str(today)
            sql1 ="update acc_details set balance = balance + {} where account_no = {} and status = 'active' ;".format(amount,acno)
            sql2 = "insert into transaction(tid,amount,type,account_no,dot) values({},{},'Deposit',{},'{}');".format(tid, amount ,acno ,str(today))
            cursor.execute(sql2)
            cursor.execute(sql1)
            #print(sql1)
            #print(sql2)
            conn.commit()
            print('\n\namount deposited')
        else:
              print('\n\nClosed or Suspended Account....')
        
        wait= input('\n\n\n Press any key to continue....')
        conn.close()

    def withdraw_amount():
        conn = mysql.connector.connect(
            host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        acno = input('Enter account No :')
        amount = input('Enter amount :')
        today = date.today()
        result = admin.account_status(int(acno))
        #print(result)
        if result[0] == 'active' and int(result[1])>=int(amount):
            tid=str(acno)+str(today)
            sql1 = "update acc_details set balance = balance-{} where account_no = {} and status= 'active' ;".format(amount,acno)
            sql2 = "insert into transaction(tid,amount,type,account_no,dot) values({},{},'Withdraw',{},'{}');".format(tid, amount ,acno ,str(today))
            cursor.execute(sql2)
            cursor.execute(sql1)
            #print(sql1)
            #print(sql2)
            conn.commit()
            print('\n\namount Withdrawn')

        else:
              print('\n\nClosed or Suspended Account.Or Insufficient amount')

        wait = input('\n\n\n Press any key to continue....')
        conn.close()

    def daily_report():
        conn = mysql.connector.connect(host='localhost', database='bankproject', user='root', password=' ')
        today = date.today()
        cursor = conn.cursor()
        sql = "select tid,dot,amount,type,account_no from transaction  where dot= '{}';".format(str(today))
        cursor.execute(sql)
        records = cursor.fetchall()
        print('Daily Report :',today)
        print('-'*120)
        for record in records:
               print(record[0], record[1], record[2], record[3], record[4])
        print('-'*120)

        conn.close()
        wait = input('\n\n\n Press any key to continue....')
        front()

    def monthly_report():
        conn = mysql.connector.connect(
           host='localhost', database='bankproject', user='root', password=' ')
        today = date.today()
        cursor = conn.cursor()
        sql = "select tid,dot,amount,type,account_no from transaction  where month(dot)= '{}' ;".format(str(today).split('-')[1])
        cursor.execute(sql)
        records = cursor.fetchall()
        print(sql)
        print('Monthly Report :', str(today).split('-')[1], '-,', str(today).split('-')[0])
        print('-'*120)
        for record in records:
               print(record[0], record[1], record[2], record[3], record[4])
        print('-'*120)

        conn.close()
        wait = input('\n\n\n Press any key to continue....')
        front()

    def transaction_menu():
        while True:
            print(' Trasaction Menu')
            print("\n1.  Deposit Amount")
            print('\n2.  WithDraw Amount')
            print('\n3.  Back to Main Menu')
            print('\n\n')
            choice = int(input('Enter your choice ...: '))
            if choice == 1:
                bank.deposit_amount()
            if choice == 2:
                bank.withdraw_amount()
            if choice == 3:
                break

    def search_menu():
        conn = mysql.connector.connect(
           host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        while True:
            print(' Search Menu')
            print("\n1.  Account No")
            print('\n2.  Aadhar Card')
            print('\n3.  Phone No')
            print('\n4.  Email')
            print('\n5.  Name')
            print('\n6.  Back to Main Menu')
            choice = int(input('Enter your choice ...: '))
            field_name=''
       
            if choice == 1:
                field_name ='account_no'
      
            if choice == 2:
                field_name ='aadhar_no'
       
            if choice == 3:
                field_name = 'mobile_no'
          
            if choice == 4:
                field_name = 'email'

            if choice == 5:
                field_name = 'name'
          
            if choice == 6:
                break
            msg ='Enter '+field_name+': '
            value = input(msg)
            if field_name=='account_no':
                sql = "select * from acc_details where {} = {};".format(field_name,value)
                print(sql)
            else:
                sql = "select * from acc_details where {} like {};".format(field_name,value)
                #print(sql)
            cursor.execute(sql)
            records = cursor.fetchall()
            print(records)
            n = len(records)
            print('Search Result for ', field_name, ' ',value)
            print('-'*80)
            for record in records:
                   print(record[0], record[1], record[2], record[3],
             record[4], record[5], record[6], record[7], record[8])
            if(n <= 0):
                print(field_name, ' ', value, ' does not exist')
                wait = input('\n\n\n Press any key to continue....')

        conn.close()
        wait=input('\n\n\n Press any key to continue....')



    def account_details():
        
        acno = input('Enter account no :')
        conn = mysql.connector.connect(
            host='localhost', database='bankproject', user='root', password=' ')
        cursor = conn.cursor()
        sql ="select * from acc_details where account_no ={};".format(acno)
        sql1 = "select tid,dot,amount,type from transaction t where t.account_no= {} ;".format(acno)
        cursor.execute(sql)
        result = cursor.fetchone()
        
        print('Account Details')
        print('-'*80)
        print('Account No :',result[0])
        print('Customer Name :',result[1])
        print('Address :',result[2])
        print('Phone NO :',result[3])
        print('Email ID :',result[4])
        print('Aadhar No :',result[5])
        print('Account Type :',result[8])
        print('Account Status :',result[7])
        print('Current Balance :',result[6])
        print('-'*80)
        cursor.execute(sql1)
        results = cursor.fetchall()
        for result in results:
            print(result[0], result[1], result[2], result[3])
        conn.commit()
        conn.close()
        wait=input('\n\n\nPress any key to continue.....')

    def report_menu():
        while True:
          
            print('\n')
            print('\n1.  Account Details')
            print('\n2.  Back to Main Menu')
            choice = int(input('Enter your choice ...: '))
            if choice == 1:
                bank.account_details()
            if choice == 2:
                break

def exitbank():
    print("Thank You for visiting!!")
        
def front():
    print(' Main Menu')
    print('\n1.  Admin sign in')
    print('\n2.  User sign up')
    print('\n3.  User sign in')
    print('\n4.  Exit')
    choice = int(input('Enter your choice ...: '))
    if choice ==1:
        admin.admin()
    if choice ==2 :
        user.usign_up()
    if choice ==3:
        bank.usign_in()
    if choice ==4 :
        
        exitbank()

front()
